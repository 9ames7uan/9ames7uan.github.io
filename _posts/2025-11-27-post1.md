---
layout: post
title: macOS 開發環境重構：MacPorts 遷移指南
date: 2015-07-15 15:09:00
description: 這份指南記錄了我從 Homebrew All-in-One 轉換至 Hybrid Setup（Homebrew Cask for Apps + MacPorts for CLI）的流程
tags: formatting code
categories: sample-posts
featured: true
---

這份指南記錄了從 Homebrew All-in-One 轉換至 <font color="#ec7e42">Hybrid Setup</font> (Homebrew Cask for Apps + MacPorts for CLI) 的完整流程。此配置是圖確保開發環境（如 C/C++, Python）與系統應用程式嚴格隔離，避免依賴衝突。

## 1. 核心概念與架構

* GUI 應用程式 （Chrome, VS Code, Slack）：使用 <font color="#ec7e42">Homebrew Cask</font> 管理 (方便、可自動更新)。
* CLI 開發工具 （Git, GCC, Python, Node）：使用 <font color="#ec7e42">MacPorts</font> 管理 (嚴謹、隔離性高、權限明確)。
* 路徑優先級：<font color="#ec7e42">MacPorts (/opt/local) > Homebrew (/opt/homebrew) > System (/usr/bin)</font>。

## 2. 第一階段：清理 Homebrew Formulae

保留 Cask，移除所有可能干擾 MacPorts 的 CLI 工具。

```bash
# 1. 備份清單 (選用)
brew list --cask > ~/Desktop/brew_casks.txt
brew list --formula > ~/Desktop/brew_formulae.txt

# 2. 強制移除所有 Formulae (Libraries/CLI)
brew list --formula | xargs brew uninstall --force --ignore-dependencies

# 3. 清理殘留檔案
brew cleanup --prune=all
````

## 3. 第二階段：安裝與設定 MacPorts

### 3.1 安裝

1. 從 MacPorts 官網下載對應 macOS 版本的 .pkg 並安裝。
    
2. 執行自我更新：
    
    Bash
    
    ```
    sudo port -v selfupdate
    ```
    

### 3.2 設定 PATH (關鍵)

編輯 ~/.zshrc，將 MacPorts 路徑置頂，確保優先權正確。

Bash

```
# ==============================================
# HYBRID SETUP: MacPorts > Homebrew > System
# ==============================================

# 1. MacPorts (High Priority)
export PATH="/opt/local/bin:/opt/local/sbin:$PATH"

# 2. Homebrew Cask Only (Lower Priority)
if [[ -d "/opt/homebrew/bin" ]]; then
  export PATH="$PATH:/opt/homebrew/bin"
fi
```

設定完成後務必執行 <font color="#ec7e42">source ~/.zshrc</font> 並用 <font color="#ec7e42">which git</font> 檢查是否為 <font color="#ec7e42">/opt/local/bin/git</font>。

## 4. 第三階段：安裝核心開發工具

### 4.1 基礎工具與編譯器

Bash

```
# Git 與基礎 Shell 工具
sudo port install git trash gsed xz zstd

# 建置系統 (C/C++ 必備)
sudo port install cmake ninja autoconf automake libtool pkgconfig
```

## 4.2 C/C++ (LLVM/Clang)

Bash

```
# 安裝 Clang 17
sudo port install clang-17

# 設定為系統預設 clang 指令
sudo port select --set clang mp-clang-17
```

### 4.3 Python 環境

原則：<font color="#ec7e42">Global 只裝 Python 本體，套件一律用 venv 安裝。</font>

Bash

```
# 安裝 Python 3.13 與 pip
sudo port install python313 py313-pip

# 設定預設版本
sudo port select --set python3 python313
sudo port select --set pip pip313
```

### 4.4 Java (OpenJDK)

Bash

```
sudo port install openjdk21
```

若系統抓不到 Java，需在 ~/.zshrc 加入 JAVA_HOME：

Bash

```
if [[ -d "/opt/local/lib/openjdk21" ]]; then
    export JAVA_HOME="/opt/local/lib/openjdk21"
    export PATH="$JAVA_HOME/bin:$PATH"
fi
```

## 5. 第四階段：修復 VS Code 開發環境

因路徑變更，需手動修正 VS Code 的 C/C++ 設定。

### 5.1 IntelliSense (c_cpp_properties.json)

- Compiler path: 修改為 <font color="#ec7e42">/opt/local/bin/clang++</font>
    
- IntelliSense mode: 設定為 <font color="#ec7e42">macos-clang-x64</font> (Intel) 或 macos-clang-arm64 (Apple Silicon)。
    

### 5.2 Code Runner (settings.json)

若使用 Code Runner 執行程式，需修改 executorMap 以移除舊的 Homebrew 路徑參數。

JSON

```
"code-runner.executorMap": {
    "c": "cd $dir && /opt/local/bin/clang $fileName -o $fileNameWithoutExt && $dir$fileNameWithoutExt",
    "cpp": "cd $dir && /opt/local/bin/clang++ -std=c++23 -fexperimental-library $fileName -o $fileNameWithoutExt && $dir$fileNameWithoutExt"
}
```

## 6. 常見問題與解決

|**問題現象**|**原因**|**解決方案**|
|---|---|---|
|dyld: Library not loaded|執行了舊的 Python (pyenv)，其依賴的 Homebrew lib 已被刪除。|刪除舊的 venv，使用 MacPorts 的 Python 重建 (<font color="#ec7e42">python3 -m venv venv</font>)。|
|zsh: command not found: pyenv|pyenv 已隨 Homebrew 移除，但相關設定殘留。|刪除 ~/.pyenv 資料夾，並移除 ~/.zshrc 中的 pyenv 設定。|
|port command not found|PATH 設定未生效。|檢查 ~/.zshrc 語法並執行 source ~/.zshrc。|
|ld: warning: directory not found|編譯指令中殘留舊的 -L/usr/local/... 參數。|檢查 VS Code 的 tasks.json 或 settings.json 並清除舊路徑。|

## 7. 未來維護指令

- 更新軟體庫與核心: <font color="#ec7e42">sudo port -v selfupdate</font>
    
- 升級過期軟體: <font color="#ec7e42">sudo port upgrade outdated</font>
    
- 尋找軟體: <font color="#ec7e42">port search <name></font>
    
- 清理舊版本: <font color="#ec7e42">sudo port uninstall inactive</font>
    

